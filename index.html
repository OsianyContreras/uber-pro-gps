<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uber Pro GPS</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<style>
body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,system-ui;background:radial-gradient(circle at top,#020617,#000);color:#fff;display:flex;justify-content:center}
.card{width:100%;max-width:420px;margin:16px;padding:18px;border-radius:20px;background:#020617;position:relative;box-shadow:0 0 0 1px rgba(148,163,184,.15),0 30px 60px rgba(0,0,0,.7);animation:fadeIn .8s ease}
.card::before{content:"";position:absolute;inset:-2px;border-radius:22px;background:linear-gradient(120deg,#22c55e,#38bdf8,#22c55e);z-index:-1;animation:borderGlow 6s linear infinite}
@keyframes borderGlow{0%{filter:hue-rotate(0deg)}100%{filter:hue-rotate(360deg)}}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1}}
h1{text-align:center;font-size:20px;margin-bottom:10px}
img{width:100%;max-height:35vh;object-fit:contain;border-radius:14px;margin-top:12px;background:#000;display:none}
button{width:100%;padding:15px;margin-top:12px;border-radius:14px;border:none;font-size:16px;font-weight:600;background:#22c55e;color:#000;cursor:pointer}
button.secondary{background:#38bdf8}
button.gray{background:#64748b;color:#fff}
button.danger{background:#ef4444;color:#fff}
button:disabled{opacity:.4}
.status{margin-top:10px;font-size:14px;color:#94a3b8;text-align:center}
.coords{margin-top:10px;padding:10px;border-radius:12px;background:#020617;border:1px solid rgba(148,163,184,.15)}
.coords b{color:#22c55e;text-shadow:0 0 8px rgba(34,197,94,.6)}
.highlight{background:rgba(34,197,94,.15);padding:2px 6px;border-radius:6px}
#debug{margin-top:12px;font-size:11px;background:#000;padding:8px;border-radius:10px;max-height:80px;overflow:auto;display:none;color:#aaa}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(20px);background:#22c55e;color:#000;padding:10px 16px;border-radius:14px;font-size:14px;font-weight:600;opacity:0;transition:all .3s ease;z-index:100}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
</style>
</head>
<body>

<div class="card">
  <h1>üöó Uber Pro GPS</h1>
  <input type="file" id="fileInput" accept="image/*">
  <img id="preview">
  
  <button id="analyzeBtn">Analizar Trayecto</button>
  <div class="status" id="status">Esperando imagen...</div>

  <div class="coords" id="coords">
    Latitud: ‚Äî<br>Longitud: ‚Äî<br>App: ‚Äî
  </div>

  <button id="copyBtn" class="gray" disabled>üìã Copiar y Abrir Sygic</button>
  <button id="navigateBtn" class="secondary" disabled>üöÄ Solo Abrir Sygic</button>
  <button id="resetBtn" class="danger">üîÑ Nueva Consulta</button>

  <div id="debug"></div>
</div>

<div id="toast" class="toast">üìã Copiado y abriendo Sygic...</div>

<script>
let lat = null, lng = null;

// --- FUNCI√ìN NAVEGAR (S√çNCRONA Y DIRECTA) ---
function ejecutarSygic() {
  if (!lat || !lng) return;
  
  // IMPORTANTE: Sygic en iOS prefiere Longitud antes que Latitud
  // Formato: com.sygic.aura://coordinate|long|lat|drive
  const url = "com.sygic.aura://coordinate|" + lng + "|" + lat + "|drive";
  
  // Usamos location.href de forma directa sin esperas
  window.location.href = url;
}

// --- FUNCI√ìN COPIAR (S√çNCRONA) ---
function copiarAlPortapapeles() {
  const texto = lat + "," + lng;
  const el = document.createElement('textarea');
  el.value = texto;
  document.body.appendChild(el);
  el.select();
  document.execCommand('copy');
  document.body.removeChild(el);
  
  const t = document.getElementById("toast");
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2000);
}

// --- LOGICA DE IMAGEN Y OCR ---
document.getElementById("fileInput").onchange = e => {
  const f = e.target.files[0];
  if(!f) return;
  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(f);
  img.style.display = "block";
  document.getElementById("status").textContent = "Imagen cargada.";
};

document.getElementById("analyzeBtn").onclick = async () => {
  const status = document.getElementById("status");
  status.textContent = "Analizando texto... üîç";
  
  try {
    const r = await Tesseract.recognize(document.getElementById("preview").src, "eng");
    const m = r.data.text.match(/(-?\d{1,2}\.\d+)[,\s]+(-?\d{1,3}\.\d+)/);
    
    if(!m) throw "No se hallaron coordenadas";

    lat = m[1];
    lng = m[2];

    document.getElementById("coords").innerHTML = `
      Latitud: <span class="highlight"><b>${lat}</b></span><br>
      Longitud: <span class="highlight"><b>${lng}</b></span><br>
      Status: <b>Lista para Sygic</b>
    `;

    document.getElementById("copyBtn").disabled = false;
    document.getElementById("navigateBtn").disabled = false;
    status.textContent = "An√°lisis completo.";
  } catch(e) {
    status.textContent = "Error: " + e;
  }
};

// --- BOTONES CORREGIDOS ---

// Bot√≥n: Copiar y Abrir (Combinaci√≥n s√≠ncrona)
document.getElementById("copyBtn").onclick = function() {
  copiarAlPortapapeles();
  ejecutarSygic();
};

// Bot√≥n: Solo Abrir (Acci√≥n directa)
document.getElementById("navigateBtn").onclick = function() {
  ejecutarSygic();
};

// Bot√≥n: Reset
document.getElementById("resetBtn").onclick = () => {
  location.reload();
};
</script>
</body>
</html>
