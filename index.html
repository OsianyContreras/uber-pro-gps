<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uber Pro GPS</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body{
  margin:0;
  padding:0;
  font-family:-apple-system, BlinkMacSystemFont, system-ui;
  background:radial-gradient(circle at top,#020617,#000);
  color:#fff;
  display:flex;
  justify-content:center;
}

.card{
  width:100%;
  max-width:420px;
  margin:16px;
  padding:18px;
  border-radius:20px;
  background:#020617;
  position:relative;
  box-shadow:0 0 0 1px rgba(148,163,184,.15),
             0 30px 60px rgba(0,0,0,.7);
  animation:fadeIn .8s ease;
}

.card::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:22px;
  background:linear-gradient(120deg,#22c55e,#38bdf8,#22c55e);
  z-index:-1;
  animation:borderGlow 6s linear infinite;
}

@keyframes borderGlow{
  0%{filter:hue-rotate(0deg)}
  100%{filter:hue-rotate(360deg)}
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1}
}

h1{
  text-align:center;
  font-size:20px;
  margin-bottom:10px;
}

input[type=file]{
  width:100%;
  margin-top:10px;
}

img{
  width:100%;
  max-height:35vh;
  object-fit:contain;
  border-radius:14px;
  margin-top:12px;
  background:#000;
}

button{
  width:100%;
  padding:15px;
  margin-top:12px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  background:#22c55e;
  color:#000;
}

button.secondary{background:#38bdf8}
button.gray{background:#64748b;color:#fff}
button:disabled{opacity:.4}

.status{
  margin-top:10px;
  font-size:14px;
  color:#94a3b8;
}

.coords{
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  background:#020617;
  border:1px solid rgba(148,163,184,.15);
}

.coords b{
  color:#22c55e;
  text-shadow:0 0 8px rgba(34,197,94,.6);
}

.highlight{
  background:rgba(34,197,94,.15);
  padding:2px 6px;
  border-radius:6px;
}

.history{
  margin-top:12px;
  font-size:14px;
  color:#94a3b8;
}

#debug{
  margin-top:12px;
  font-size:12px;
  background:#000;
  padding:8px;
  border-radius:10px;
  max-height:120px;
  overflow:auto;
}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%) translateY(20px);
  background:#22c55e;
  color:#000;
  padding:10px 16px;
  border-radius:14px;
  font-size:14px;
  font-weight:600;
  opacity:0;
  pointer-events:none;
  transition:all .3s ease;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}
</style>
</head>

<body>
<div class="card">
<h1>ðŸš— Uber Pro GPS</h1>

<input type="file" id="fileInput" accept="image/*">
<img id="preview">

<button id="analyzeBtn">Analizar Trayecto</button>

<div class="status" id="status">Estado: esperando imagen</div>

<div class="coords" id="coords">
Latitud: â€”<br>Longitud: â€”<br>App: â€”
</div>

<button id="copyBtn" class="gray" disabled>ðŸ“‹ Copiar de nuevo</button>
<button id="navigateBtn" class="secondary" disabled>Navegar PRO</button>

<div class="history" id="history"></div>
<div id="debug"><b>DEBUG:</b><br></div>
</div>

<div id="toast" class="toast">ðŸ“‹ Coordenadas copiadas</div>

<script>
const debug = msg=>{
  document.getElementById("debug").innerHTML+=msg+"<br>";
};

let lat=null,lng=null,appDetectada="â€”";

function copiedFeedback(){
  const t=document.getElementById("toast");
  t.classList.add("show");
  if(navigator.vibrate) navigator.vibrate(40);
  setTimeout(()=>t.classList.remove("show"),2000);
}

fileInput.onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  preview.src=URL.createObjectURL(f);
  status.textContent="Estado: Imagen preparada para OCR";
};

analyzeBtn.onclick=async()=>{
  status.textContent="Estado: OCR en procesoâ€¦";
  try{
    const r=await Tesseract.recognize(preview.src,"eng");
    const t=r.data.text;

    if(/uber/i.test(t)) appDetectada="Uber";
    if(/didi/i.test(t)) appDetectada="Didi";

    const m=t.match(/(-?\d{1,2}\.\d+)[,\s]+(-?\d{1,3}\.\d+)/);
    if(!m) throw "Sin coordenadas";

    lat=m[1]; lng=m[2];

    coords.innerHTML=`
      Latitud: <span class="highlight"><b>${lat}</b></span><br>
      Longitud: <span class="highlight"><b>${lng}</b></span><br>
      App: <b>${appDetectada}</b>
    `;

    copiarCoordenadas();
    guardarHistorial();

    navigateBtn.disabled=false;
    copyBtn.disabled=false;
    status.textContent="Estado: Coordenadas detectadas";
  }catch(e){
    status.textContent="Error al analizar imagen";
  }
};

function copiarCoordenadas(){
  navigator.clipboard.writeText(`${lat},${lng}`);
  copiedFeedback();
}

copyBtn.onclick=copiarCoordenadas;

/* ===== DETECCIÃ“N REAL DE SYGIC ===== */
navigateBtn.onclick=()=>{
  const sygic=`com.sygic.aura://coordinate|${lat},${lng}`;
  const google=`https://maps.google.com/?q=${lat},${lng}`;

  let appOpened=false;

  const iframe=document.createElement("iframe");
  iframe.style.display="none";
  iframe.src=sygic;
  document.body.appendChild(iframe);

  const start=Date.now();

  setTimeout(()=>{
    if(Date.now()-start<1200){
      window.open(google,"_blank");
    }
  },1200);
};

/* ===== HISTORIAL ===== */
function guardarHistorial(){
  const h=JSON.parse(localStorage.getItem("historial")||"[]");
  h.unshift({lat,lng,app:appDetectada,fecha:new Date().toLocaleString()});
  localStorage.setItem("historial",JSON.stringify(h.slice(0,5)));
  mostrarHistorial();
}

function mostrarHistorial(){
  const h=JSON.parse(localStorage.getItem("historial")||"[]");
  history.innerHTML="<b>Historial:</b><br>"+h.map(x=>
    `â€¢ ${x.app} â†’ ${x.lat},${x.lng}`
  ).join("<br>");
}
mostrarHistorial();
</script>
</body>
</html>
