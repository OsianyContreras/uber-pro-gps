<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Uber Pro GPS - Ultimate</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<style>
:root {
    --primary: #22c55e;
    --bg-card: #020617;
    --text-main: #fff;
    --text-dim: #94a3b8;
    --glow: rgba(34, 197, 94, 0.4);
}

body.day-mode {
    --primary: #00ff00;
    --bg-card: #051024;
    --glow: rgba(0, 255, 0, 0.6);
}

body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#000;color:var(--text-main);display:flex;justify-content:center;min-height:100vh;align-items:center;transition: background 0.3s}

.card{width:100%;max-width:400px;margin:20px;padding:24px;border-radius:28px;background:var(--bg-card);position:relative;box-shadow:0 20px 40px -10px rgba(0,0,0,0.7);animation:slideUp .6s ease-out;overflow:hidden}
.card::before{content:"";position:absolute;inset:-2px;border-radius:30px;background:linear-gradient(45deg,var(--primary),#0ea5e9,var(--primary));z-index:-1;filter:blur(1px);opacity:.5;animation:borderRotate 4s linear infinite}

@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes borderRotate{0%{filter:hue-rotate(0deg)}100%{filter:hue-rotate(360deg)}}

.img-container {
    position: relative;
    width: 100%;
    margin-top: 15px;
    border-radius: 16px;
    overflow: hidden;
    background: #000;
}
img{width:100%;max-height:250px;object-fit:contain;display:none;opacity:0;transition:opacity .4s ease}
img.loaded{display:block;opacity:1}

.scanner-line {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--primary);
    box-shadow: 0 0 15px var(--primary);
    display: none;
    z-index: 10;
}
.scanning .scanner-line {
    display: block;
    animation: scanMove 2s infinite ease-in-out;
}
@keyframes scanMove {
    0% { top: 0; }
    50% { top: 100%; }
    100% { top: 0; }
}

.top-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.theme-toggle { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 8px 12px; border-radius: 20px; font-size: 12px; cursor: pointer; }

h1{font-size:20px;margin:0;font-weight:800}

.coords{
  margin-top:20px;padding:20px;border-radius:20px;background:rgba(34,197,94,0.05);
  border: 2px solid var(--primary);cursor:pointer;transition:all 0.3s;
  opacity:0;transform:translateY(10px);pointer-events:none;text-align: center;
  box-shadow: 0 0 15px var(--glow);
}
.coords.show{opacity:1;transform:translateY(0);pointer-events:auto}
.coords:active{transform:scale(0.95)}
.coords b{color:var(--primary);font-size:1.4em;text-shadow: 0 0 10px var(--glow); font-family: monospace}

.history-title { font-size: 12px; color: var(--text-dim); margin-top: 25px; text-align: center; text-transform: uppercase; letter-spacing: 1px;}
.history-list { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
.history-item { 
    width: 45px; height: 45px; border-radius: 50%; background: rgba(255,255,255,0.05); 
    border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; 
    justify-content: center; font-size: 10px; color: var(--primary); cursor: pointer;
}

button.main-btn{width:100%;padding:16px;margin-top:12px;border-radius:16px;border:none;font-size:16px;font-weight:700;background:var(--primary);color:#000;cursor:pointer;box-shadow:0 4px 15px var(--glow)}
button.share-btn{background:#0ea5e9; color:#fff; margin-top: 10px; display: none; box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);}
button.share-btn.show { display: block; animation: slideUp 0.4s ease; }
button.danger{background:transparent;color:#ef4444;border:1px solid rgba(239,68,68,0.2);padding:10px;margin-top:20px; font-size: 12px;}

.copyright{margin-top:30px;text-align:center;font-size:11px;color:var(--text-dim);font-weight:600}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(40px);background:var(--primary);color:#000;padding:12px 24px;border-radius:30px;font-size:14px;font-weight:800;opacity:0;transition:all .4s;z-index:100}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
</style>
</head>
<body>

<div class="card">
  <div class="top-controls">
    <h1>üöó Uber Pro GPS</h1>
    <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô NOCHE</button>
  </div>
  
  <input type="file" id="fileInput" accept="image/*">
  
  <div class="img-container" id="imgBox">
    <div class="scanner-line"></div>
    <img id="preview">
  </div>
  
  <button id="analyzeBtn" class="main-btn">üîç ANALIZAR CAPTURA</button>
  
  <div id="status" style="text-align:center; margin-top:10px; font-size:13px; color:#94a3b8;">Listo para procesar</div>

  <div class="coords" id="coordsBlock" onclick="copiarAlPortapapeles()">
    <div style="font-size:11px; color:var(--text-dim); margin-bottom:5px;">COORDENADAS DETECTADAS</div>
    <b id="latVal">0.0000</b><br>
    <b id="lngVal">0.0000</b>
    <div style="font-size:12px; color:var(--primary); margin-top:10px; font-weight:700">üëÜ TOCA PARA COPIAR</div>
  </div>

  <button id="shareBtn" class="main-btn share-btn" onclick="compartirNativo()">üöÄ ENVIAR A GPS / SYGIC</button>

  <div class="history-title">√öltimos 3 registros</div>
  <div class="history-list" id="historyList"></div>

  <button onclick="location.reload()" class="main-btn danger">üîÑ NUEVA CONSULTA</button>

  <div class="copyright">@Copyright: Osiany2026</div>
</div>

<div id="toast" class="toast">‚úÖ ¬°LISTO!</div>

<script>
let currentLat = null, currentLng = null;
const historyKey = "gps_history_osiany";

function toggleTheme() {
    document.body.classList.toggle('day-mode');
    const isDay = document.body.classList.contains('day-mode');
    document.getElementById('themeBtn').textContent = isDay ? "‚òÄÔ∏è D√çA" : "üåô NOCHE";
}

// --- CAMBIO CLAVE AQU√ç: COMPARTIR COMO UBICACI√ìN REAL ---
async function compartirNativo() {
    if (!currentLat || !currentLng) return;
    
    // Creamos un link que iOS interpreta como mapa obligatoriamente
    const mapUrl = `http://maps.apple.com/?q=${currentLat},${currentLng}`;
    
    if (navigator.share) {
        try {
            await navigator.share({
                title: 'Ubicaci√≥n Detectada',
                text: `Coordenadas: ${currentLat}, ${currentLng}`,
                url: mapUrl // Al enviar una URL de maps.apple.com, iOS activa las apps de GPS
            });
        } catch (err) { console.log("Error al compartir"); }
    } else {
        copiarAlPortapapeles();
    }
}

function saveToHistory(lat, lng) {
    let history = JSON.parse(localStorage.getItem(historyKey) || "[]");
    history.unshift({lat, lng, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})});
    history = history.slice(0, 3);
    localStorage.setItem(historyKey, JSON.stringify(history));
    renderHistory();
}

function renderHistory() {
    const container = document.getElementById("historyList");
    const history = JSON.parse(localStorage.getItem(historyKey) || "[]");
    container.innerHTML = history.map(item => `
        <div class="history-item" onclick="loadFromHistory('${item.lat}','${item.lng}')">
            ${item.time}
        </div>
    `).join("");
}

function loadFromHistory(lat, lng) {
    currentLat = lat; currentLng = lng;
    document.getElementById("latVal").textContent = lat;
    document.getElementById("lngVal").textContent = lng;
    document.getElementById("coordsBlock").classList.add("show");
    document.getElementById("shareBtn").classList.add("show");
    mostrarToast("‚úÖ Recuperado del historial");
}

function mostrarToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    if(navigator.vibrate) navigator.vibrate(50);
    setTimeout(() => t.classList.remove("show"), 2500);
}

function copiarAlPortapapeles() {
    const el = document.createElement('textarea');
    el.value = `${currentLat},${currentLng}`;
    document.body.appendChild(el);
    el.select();
    document.execCommand('copy');
    document.body.removeChild(el);
    mostrarToast("‚úÖ COPIADO AL PORTAPAPELES");
}

document.getElementById("fileInput").onchange = e => {
    const f = e.target.files[0];
    if(!f) return;
    const img = document.getElementById("preview");
    img.src = URL.createObjectURL(f);
    img.classList.add("loaded");
    document.getElementById("status").textContent = "Imagen cargada";
};

document.getElementById("analyzeBtn").onclick = async () => {
    const img = document.getElementById("preview");
    if(!img.src) return alert("Selecciona una captura");
    
    document.getElementById("imgBox").classList.add("scanning");
    document.getElementById("status").textContent = "Escaneando...";
    document.getElementById("analyzeBtn").disabled = true;

    try {
        const r = await Tesseract.recognize(img.src, "eng");
        const m = r.data.text.match(/(-?\d{1,2}\.\d+)[,\s\n]+(-?\d{1,3}\.\d+)/);
        
        if(!m) throw "No encontr√© coordenadas";

        currentLat = m[1];
        currentLng = m[2];

        document.getElementById("latVal").textContent = currentLat;
        document.getElementById("lngVal").textContent = currentLng;
        document.getElementById("coordsBlock").classList.add("show");
        document.getElementById("shareBtn").classList.add("show");
        document.getElementById("status").textContent = "‚úÖ √âxito";
        
        saveToHistory(currentLat, currentLng);
    } catch(e) {
        document.getElementById("status").textContent = "‚ùå Error";
    } finally {
        document.getElementById("imgBox").classList.remove("scanning");
        document.getElementById("analyzeBtn").disabled = false;
    }
};

renderHistory();
</script>
</body>
</html>
