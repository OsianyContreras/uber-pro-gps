<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uber Pro GPS</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body{
  margin:0;
  padding:0;
  font-family:-apple-system, BlinkMacSystemFont, system-ui;
  background:radial-gradient(circle at top,#020617,#000);
  color:#fff;
  display:flex;
  justify-content:center;
}

.card{
  width:100%;
  max-width:420px;
  margin:16px;
  padding:18px;
  border-radius:20px;
  background:#020617;
  position:relative;
  box-shadow:0 0 0 1px rgba(148,163,184,.15),
             0 30px 60px rgba(0,0,0,.7);
}

h1{text-align:center;font-size:20px;margin-bottom:10px}

input[type=file]{width:100%;margin-top:10px}

img{
  width:100%;
  max-height:35vh;
  object-fit:contain;
  border-radius:14px;
  margin-top:12px;
  background:#000;
}

button{
  width:100%;
  padding:15px;
  margin-top:12px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  background:#22c55e;
  color:#000;
}

button.secondary{background:#38bdf8}
button:disabled{opacity:.4}

.status{margin-top:10px;font-size:14px;color:#94a3b8}

.coords{
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  background:#020617;
  border:1px solid rgba(148,163,184,.15);
}

#debug{
  margin-top:12px;
  font-size:12px;
  background:#000;
  padding:8px;
  border-radius:10px;
  max-height:120px;
  overflow:auto;
}
</style>
</head>

<body>
<div class="card">
<h1>ðŸš— Uber Pro GPS</h1>

<input type="file" id="fileInput" accept="image/*">
<img id="preview">

<button id="analyzeBtn">Analizar Trayecto</button>

<div class="status" id="status">Estado: esperando imagen</div>

<div class="coords" id="coords">
Latitud: â€”<br>Longitud: â€”
</div>

<button id="resetBtn" class="secondary" disabled>Nueva Consulta</button>

<div id="debug"><b>DEBUG:</b><br></div>
</div>

<script>
const debug = msg=>{
  document.getElementById("debug").innerHTML += msg+"<br>";
};

let lat=null,lng=null;

fileInput.onchange = e=>{
  const f = e.target.files[0];
  if(!f) return;
  preview.src = URL.createObjectURL(f);
  status.textContent = "Estado: Imagen preparada para OCR";
  debug("Imagen cargada");
};

analyzeBtn.onclick = async ()=>{
  if(!fileInput.files[0]){
    status.textContent="Selecciona una imagen";
    return;
  }

  status.textContent="Estado: OCR en procesoâ€¦";
  debug("OCR iniciado");

  try{
    const result = await Tesseract.recognize(
      fileInput.files[0],   // ðŸ”¥ CLAVE: usar el archivo, NO preview.src
      'eng',
      { logger: m => debug(m.status) }
    );

    const text = result.data.text;
    debug("Texto OCR capturado");

    const match = text.match(/(-?\d{1,2}\.\d+)[,\s]+(-?\d{1,3}\.\d+)/);
    if(!match) throw "No se detectaron coordenadas";

    lat = match[1];
    lng = match[2];

    const coordsText = `${lat},${lng}`;

    coords.innerHTML = `
      Latitud: <b>${lat}</b><br>
      Longitud: <b>${lng}</b>
    `;

    // ðŸ“‹ Copia automÃ¡tica
    await navigator.clipboard.writeText(coordsText);

    // ðŸ“³ VibraciÃ³n ligera
    if(navigator.vibrate) navigator.vibrate(50);

    status.textContent="Coordenadas detectadas y copiadas";
    resetBtn.disabled=false;

    // ðŸš€ Intento directo de abrir Sygic
    window.location.href = `com.sygic.aura://coordinate|${coordsText}`;

  }catch(e){
    debug("ERROR OCR: "+e);
    status.textContent="Error al procesar la imagen";
  }
};

resetBtn.onclick = ()=>{
  fileInput.value="";
  preview.src="";
  lat=lng=null;
  coords.innerHTML="Latitud: â€”<br>Longitud: â€”";
  status.textContent="Estado: esperando imagen";
  resetBtn.disabled=true;
};
</script>
</body>
</html>
